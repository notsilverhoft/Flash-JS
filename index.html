<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>File Extension Viewer</title>
  <style>
    body {
      font-family: monospace;
      background-color: #1e1e1e;
      color: #d4d4d4;
      padding: 20px;
      max-width: 900px;
      margin: 0 auto;
    }

    .terminal {
      background-color: #0c0c0c;
      border: 1px solid #333;
      border-radius: 5px;
      padding: 15px;
      width: 100%;
      max-width: 100%;
      height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
      color: #cccccc;
      font-family: 'Courier New', Courier, monospace;
      margin-top: 20px;
    }

    .terminal-header {
      background-color: #333333;
      padding: 8px 12px;
      border-top-left-radius: 5px;
      border-top-right-radius: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
    }

    .terminal-title {
      margin: 0;
      color: #ffffff;
      font-size: 16px;
    }

    .upload-container {
      margin: 20px 0;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .filter-container {
      margin: 10px 0;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      background-color: #2d2d2d;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #444;
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .button {
      background-color: #0e639c;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-family: monospace;
    }

    .button:hover {
      background-color: #1177bb;
    }

    input[type="file"] {
      display: none;
    }
    
    .file-name {
      margin-left: 10px;
      color: #569cd6;
    }
    
    .analyzer-button {
      background-color: #6a329f;
    }
    
    .analyzer-button:hover {
      background-color: #7d3cbc;
    }

    .toggle-button {
      background-color: #d4d4d4;
      color: #1e1e1e;
    }

    .toggle-button:hover {
      background-color: #f0f0f0;
    }

    .content-button {
      background-color: #dc3545;
      color: white;
    }

    .content-button:hover {
      background-color: #c82333;
    }

    .content-button.active {
      background-color: #28a745;
    }

    .content-button.active:hover {
      background-color: #218838;
    }

    .unparsed-button {
      background-color: #fd7e14;
      color: white;
    }

    .unparsed-button:hover {
      background-color: #e96500;
    }

    .unparsed-button.active {
      background-color: #6f42c1;
    }

    .unparsed-button.active:hover {
      background-color: #5a359a;
    }

    .error-button {
      background-color: #e74c3c;
      color: white;
    }

    .error-button:hover {
      background-color: #c0392b;
    }

    .error-button.active {
      background-color: #8e44ad;
    }

    .error-button.active:hover {
      background-color: #7d3c98;
    }

    select {
      background-color: #333;
      color: #d4d4d4;
      border: 1px solid #555;
      padding: 5px 10px;
      border-radius: 3px;
      font-family: monospace;
    }

    select:focus {
      outline: none;
      border-color: #0e639c;
    }

    .filter-label {
      color: #cccccc;
      font-size: 14px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>File Extension Viewer</h1>
  
  <div class="upload-container">
    <button class="button" id="uploadButton">SWF Here:</button>
    <span class="file-name" id="fileName"></span>
    <input type="file" id="SWF-Input" name="SWF-Input">
    <button class="button toggle-button" id="toggleButton">Show Important Tags</button>
    <button class="button content-button" id="contentButton">Show Parsed Content Only</button>
    <button class="button unparsed-button" id="unparsedButton">Show Unparsed Tags</button>
    <button class="button error-button" id="errorButton">Show Parser Errors</button>
  </div>

  <!-- Tag Type Filtering Controls -->
  <div class="filter-container hidden" id="filterContainer">
    <span class="filter-label">Filter by Tag Type:</span>
    
    <div class="filter-group">
      <label class="filter-label">Category:</label>
      <select id="categoryFilter">
        <option value="all">All Categories</option>
        <option value="control">Control Tags</option>
        <option value="display">Display Tags</option>
        <option value="asset">Asset Tags</option>
        <option value="shape">Shape Tags</option>
        <option value="sprite">Sprite Tags</option>
        <option value="font">Font Tags</option>
        <option value="text">Text Tags</option>
      </select>
    </div>

    <div class="filter-group">
      <label class="filter-label">Specific Tag:</label>
      <select id="specificTagFilter">
        <option value="all">All Tags</option>
        <!-- Control Tags -->
        <optgroup label="Control Tags">
          <option value="0">End (0)</option>
          <option value="1">ShowFrame (1)</option>
          <option value="9">SetBackgroundColor (9)</option>
          <option value="24">Protect (24)</option>
          <option value="43">FrameLabel (43)</option>
          <option value="69">FileAttributes (69)</option>
          <option value="77">Metadata (77)</option>
          <option value="86">DefineSceneAndFrameLabelData (86)</option>
        </optgroup>
        <!-- Display Tags -->
        <optgroup label="Display Tags">
          <option value="4">PlaceObject (4)</option>
          <option value="5">RemoveObject (5)</option>
          <option value="26">PlaceObject2 (26)</option>
          <option value="28">RemoveObject2 (28)</option>
        </optgroup>
        <!-- Asset Tags -->
        <optgroup label="Asset Tags">
          <option value="12">DoAction (12)</option>
          <option value="56">ExportAssets (56)</option>
          <option value="57">ImportAssets (57)</option>
          <option value="59">DoInitAction (59)</option>
          <option value="71">ImportAssets2 (71)</option>
          <option value="76">SymbolClass (76)</option>
          <option value="82">DoABC (82)</option>
        </optgroup>
        <!-- Shape Tags -->
        <optgroup label="Shape Tags">
          <option value="2">DefineShape (2)</option>
          <option value="22">DefineShape2 (22)</option>
          <option value="32">DefineShape3 (32)</option>
          <option value="83">DefineShape4 (83)</option>
        </optgroup>
        <!-- Sprite Tags -->
        <optgroup label="Sprite Tags">
          <option value="39">DefineSprite (39)</option>
        </optgroup>
        <!-- Font Tags -->
        <optgroup label="Font Tags">
          <option value="10">DefineFont (10)</option>
          <option value="13">DefineFontInfo (13)</option>
          <option value="48">DefineFont2 (48)</option>
          <option value="62">DefineFontInfo2 (62)</option>
          <option value="73">DefineFontAlignZones (73)</option>
          <option value="75">DefineFont3 (75)</option>
          <option value="88">DefineFontName (88)</option>
          <option value="90">DefineFont4 (90)</option>
        </optgroup>
        <!-- Text Tags -->
        <optgroup label="Text Tags">
          <option value="11">DefineText (11)</option>
          <option value="33">DefineText2 (33)</option>
          <option value="37">DefineEditText (37)</option>
        </optgroup>
      </select>
    </div>

    <button class="button" id="applyFilterButton">Apply Filter</button>
  </div>

  <div class="terminal-header">
    <h3 class="terminal-title">Terminal Output</h3>
  </div>
  <div class="terminal" id="terminalOutput">Waiting for file input...</div>

  <script>
    const terminal = document.getElementById('terminalOutput');
    const uploadButton = document.getElementById('uploadButton');
    const fileInput = document.getElementById('SWF-Input');
    const fileNameDisplay = document.getElementById('fileName');
    const toggleButton = document.getElementById('toggleButton');
    const contentButton = document.getElementById('contentButton');
    const unparsedButton = document.getElementById('unparsedButton');
    const errorButton = document.getElementById('errorButton');
    const filterContainer = document.getElementById('filterContainer');
    const categoryFilter = document.getElementById('categoryFilter');
    const specificTagFilter = document.getElementById('specificTagFilter');
    const applyFilterButton = document.getElementById('applyFilterButton');

    // Initialize global variables
    window.showAllTags = false;
    window.showContentParsing = false;
    window.showUnparsedOnly = false;
    window.showErrorsOnly = false;
    window.tagTypeFilter = null;

    // Add button functionality
    uploadButton.addEventListener('click', function() {
      fileInput.click();
    });

    // Toggle button functionality
    toggleButton.addEventListener('click', function() {
      window.showAllTags = !window.showAllTags;
      toggleButton.textContent = window.showAllTags ? 'Show Important Tags' : 'Show All Tags';
      
      // Re-parse if file is loaded
      reparseCurrentFile();
    });

    // Content parsing button functionality
    contentButton.addEventListener('click', function() {
      window.showContentParsing = !window.showContentParsing;
      
      if (window.showContentParsing) {
        contentButton.textContent = 'Show Tag Headers';
        contentButton.classList.add('active');
        // Show filter controls when in content mode
        filterContainer.classList.remove('hidden');
        // Hide other buttons when in content mode
        toggleButton.style.display = 'none';
        unparsedButton.style.display = 'none';
        errorButton.style.display = 'none';
        // Reset other modes
        window.showUnparsedOnly = false;
        window.showErrorsOnly = false;
        unparsedButton.classList.remove('active');
        errorButton.classList.remove('active');
      } else {
        contentButton.textContent = 'Show Parsed Content Only';
        contentButton.classList.remove('active');
        // Hide filter controls when not in content mode
        filterContainer.classList.add('hidden');
        // Show other buttons when back in header mode
        toggleButton.style.display = 'inline-block';
        unparsedButton.style.display = 'inline-block';
        errorButton.style.display = 'inline-block';
      }
      
      // Re-parse if file is loaded
      reparseCurrentFile();
    });

    // Unparsed content button functionality
    unparsedButton.addEventListener('click', function() {
      window.showUnparsedOnly = !window.showUnparsedOnly;
      
      if (window.showUnparsedOnly) {
        unparsedButton.textContent = 'Show All Tags';
        unparsedButton.classList.add('active');
        // Hide other buttons when in unparsed mode
        toggleButton.style.display = 'none';
        contentButton.style.display = 'none';
        errorButton.style.display = 'none';
        filterContainer.classList.add('hidden');
        // Reset other modes
        window.showContentParsing = false;
        window.showErrorsOnly = false;
        contentButton.classList.remove('active');
        errorButton.classList.remove('active');
      } else {
        unparsedButton.textContent = 'Show Unparsed Tags';
        unparsedButton.classList.remove('active');
        // Show other buttons when back to normal mode
        toggleButton.style.display = 'inline-block';
        contentButton.style.display = 'inline-block';
        errorButton.style.display = 'inline-block';
      }
      
      // Re-parse if file is loaded
      reparseCurrentFile();
    });

    // Error parsing button functionality
    errorButton.addEventListener('click', function() {
      window.showErrorsOnly = !window.showErrorsOnly;
      
      if (window.showErrorsOnly) {
        errorButton.textContent = 'Show All Tags';
        errorButton.classList.add('active');
        // Hide other buttons when in error mode
        toggleButton.style.display = 'none';
        contentButton.style.display = 'none';
        unparsedButton.style.display = 'none';
        filterContainer.classList.add('hidden');
        // Reset other modes
        window.showContentParsing = false;
        window.showUnparsedOnly = false;
        contentButton.classList.remove('active');
        unparsedButton.classList.remove('active');
      } else {
        errorButton.textContent = 'Show Parser Errors';
        errorButton.classList.remove('active');
        // Show other buttons when back to normal mode
        toggleButton.style.display = 'inline-block';
        contentButton.style.display = 'inline-block';
        unparsedButton.style.display = 'inline-block';
      }
      
      // Re-parse if file is loaded
      reparseCurrentFile();
    });

    // Filter functionality
    applyFilterButton.addEventListener('click', function() {
      const categoryValue = categoryFilter.value;
      const specificValue = specificTagFilter.value;
      
      if (specificValue !== 'all') {
        // Specific tag filter takes precedence
        window.tagTypeFilter = {
          type: 'specific',
          tagType: parseInt(specificValue)
        };
      } else if (categoryValue !== 'all') {
        // Category filter
        window.tagTypeFilter = {
          type: 'category',
          category: categoryValue
        };
      } else {
        // No filter
        window.tagTypeFilter = null;
      }
      
      // Re-parse if file is loaded
      reparseCurrentFile();
    });

    // Reset specific tag when category changes
    categoryFilter.addEventListener('change', function() {
      if (categoryFilter.value !== 'all') {
        specificTagFilter.value = 'all';
      }
    });

    // Reset category when specific tag changes
    specificTagFilter.addEventListener('change', function() {
      if (specificTagFilter.value !== 'all') {
        categoryFilter.value = 'all';
      }
    });

    // Function to reparse current file
    function reparseCurrentFile() {
      const fileInput = document.getElementById('SWF-Input');
      if (fileInput.files[0]) {
        const file = fileInput.files[0];
        file.arrayBuffer().then(arrayBuffer => {
          const parsedInfo = parseSWFSignature(arrayBuffer);
          const tagInfo = parseSWFTags(arrayBuffer);
          terminal.textContent = parsedInfo + '\n\n' + tagInfo;
        });
      }
    }

    document.getElementById('SWF-Input').addEventListener('change', async function(event) {
      const file = event.target.files[0];
      if (!file) {
        terminal.textContent = 'No file selected.';
        return;
      }

      // Display file name
      fileNameDisplay.textContent = file.name;

      const fileName = file.name;
      const extension = fileName.split('.').pop().toLowerCase();

      if (extension !== 'swf') {
        terminal.textContent = 'Error: File is not in SWF file format. Please use only SWF files.';
        window.start = false;
        return;
      }

      terminal.textContent = 'Determined that file is in SWF format...\nReading file...';
      window.start = true;

      try {
        const arrayBuffer = await file.arrayBuffer();
        const parsedInfo = parseSWFSignature(arrayBuffer);
        const tagInfo = parseSWFTags(arrayBuffer);
        terminal.textContent = parsedInfo + '\n\n' + tagInfo;
      } catch (err) {
        terminal.textContent = 'Error reading SWF file: ' + err.message;
      }
    });
  </script>

  <!-- Load external libraries first -->
  <script src="https://cdn.jsdelivr.net/npm/pako@2.0.4/dist/pako.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/LZMA-JS/LZMA-JS@master/src/lzma-d.js"></script>
  
  <!-- Load parser modules in dependency order -->
  <script src="JS/parsers/DataTypes.js"></script>
  <script src="JS/parsers/ControlParsers.js"></script>
  <script src="JS/parsers/DisplayParsers.js"></script>
  <script src="JS/parsers/AssetParsers.js"></script>
  <script src="JS/parsers/ShapeParsers.js"></script>
  <script src="JS/parsers/SpriteParsers.js"></script>
  <script src="JS/parsers/FontParsers.js"></script>
  <script src="JS/parsers/TextParsers.js"></script>
  <script src="JS/TagParse.js"></script>
  
  <!-- Load Parse.js LAST as it runs commands from other files -->
  <script src="JS/Parse.js"></script>
</body>
</html>
