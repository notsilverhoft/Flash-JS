<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>File Extension Viewer</title>
  <style>
    body {
      font-family: monospace;
      background-color: #1e1e1e;
      color: #d4d4d4;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .terminal {
      background-color: #0c0c0c;
      border: 1px solid #333;
      border-radius: 5px;
      padding: 15px;
      width: 100%;
      max-width: 100%;
      height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
      color: #cccccc;
      font-family: 'Courier New', Courier, monospace;
      margin-top: 20px;
    }

    .terminal-header {
      background-color: #333333;
      padding: 8px 12px;
      border-top-left-radius: 5px;
      border-top-right-radius: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
    }

    .terminal-title {
      margin: 0;
      color: #ffffff;
      font-size: 16px;
    }

    .terminals-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }

    .single-terminal {
      grid-column: 1 / -1;
    }

    .upload-container {
      margin: 20px 0;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .filter-container {
      margin: 10px 0;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      background-color: #2d2d2d;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #444;
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .button {
      background-color: #0e639c;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-family: monospace;
    }

    .button:hover {
      background-color: #1177bb;
    }

    input[type="file"] {
      display: none;
    }
    
    .file-name {
      margin-left: 10px;
      color: #569cd6;
    }
    
    .analyzer-button {
      background-color: #6a329f;
    }
    
    .analyzer-button:hover {
      background-color: #7d3cbc;
    }

    .toggle-button {
      background-color: #d4d4d4;
      color: #1e1e1e;
    }

    .toggle-button:hover {
      background-color: #f0f0f0;
    }

    .content-button {
      background-color: #dc3545;
      color: white;
    }

    .content-button:hover {
      background-color: #c82333;
    }

    .content-button.active {
      background-color: #28a745;
    }

    .content-button.active:hover {
      background-color: #218838;
    }

    .unparsed-button {
      background-color: #fd7e14;
      color: white;
    }

    .unparsed-button:hover {
      background-color: #e96500;
    }

    .unparsed-button.active {
      background-color: #6f42c1;
    }

    .unparsed-button.active:hover {
      background-color: #5a359a;
    }

    .error-button {
      background-color: #e74c3c;
      color: white;
    }

    .error-button:hover {
      background-color: #c0392b;
    }

    .error-button.active {
      background-color: #8e44ad;
    }

    .error-button.active:hover {
      background-color: #7d3c98;
    }

    .translator-button {
      background-color: #17a2b8;
      color: white;
    }

    .translator-button:hover {
      background-color: #138496;
    }

    .translator-button.active {
      background-color: #20c997;
    }

    .translator-button.active:hover {
      background-color: #1abc9c;
    }

    select {
      background-color: #333;
      color: #d4d4d4;
      border: 1px solid #555;
      padding: 5px 10px;
      border-radius: 3px;
      font-family: monospace;
    }

    select:focus {
      outline: none;
      border-color: #0e639c;
    }

    .filter-label {
      color: #cccccc;
      font-size: 14px;
    }

    .hidden {
      display: none;
    }

    .translator-controls {
      margin: 10px 0;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      background-color: #2d2d2d;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #444;
    }
  </style>
</head>
<body>
  <h1>File Extension Viewer</h1>
  
  <div class="upload-container">
    <button class="button" id="uploadButton">SWF Here:</button>
    <span class="file-name" id="fileName"></span>
    <input type="file" id="SWF-Input" name="SWF-Input">
    <button class="button toggle-button" id="toggleButton">Show Important Tags</button>
    <button class="button content-button" id="contentButton">Show Parsed Content Only</button>
    <button class="button unparsed-button" id="unparsedButton">Show Unparsed Tags</button>
    <button class="button error-button" id="errorButton">Show Parser Errors</button>
    <button class="button translator-button" id="translatorButton">Show Translator Output</button>
  </div>

  <!-- Tag Type Filtering Controls -->
  <div class="filter-container hidden" id="filterContainer">
    <span class="filter-label">Filter by Tag Type:</span>
    
    <div class="filter-group">
      <label class="filter-label">Category:</label>
      <select id="categoryFilter">
        <option value="all">All Categories</option>
        <option value="control">Control Tags</option>
        <option value="display">Display Tags</option>
        <option value="asset">Asset Tags</option>
        <option value="actionscript">ActionScript Tags</option>
        <option value="shape">Shape Tags</option>
        <option value="sprite">Sprite Tags</option>
        <option value="font">Font Tags</option>
        <option value="text">Text Tags</option>
        <option value="bitmap">Bitmap Tags</option>
        <option value="sound">Sound Tags</option>
        <option value="button">Button Tags</option>
        <option value="video">Video Tags</option>
        <option value="morph">Morph Shape Tags</option>
        <option value="scaling">Scaling Tags</option>
      </select>
    </div>

    <div class="filter-group">
      <label class="filter-label">Specific Tag:</label>
      <select id="specificTagFilter">
        <option value="all">All Tags</option>
        <!-- Control Tags -->
        <optgroup label="Control Tags">
          <option value="0">End (0)</option>
          <option value="1">ShowFrame (1)</option>
          <option value="9">SetBackgroundColor (9)</option>
          <option value="24">Protect (24)</option>
          <option value="43">FrameLabel (43)</option>
          <option value="69">FileAttributes (69)</option>
          <option value="77">Metadata (77)</option>
          <option value="86">DefineSceneAndFrameLabelData (86)</option>
        </optgroup>
        <!-- Display Tags -->
        <optgroup label="Display Tags">
          <option value="4">PlaceObject (4)</option>
          <option value="5">RemoveObject (5)</option>
          <option value="26">PlaceObject2 (26)</option>
          <option value="28">RemoveObject2 (28)</option>
          <option value="70">PlaceObject3 (70)</option>
        </optgroup>
        <!-- Asset Tags -->
        <optgroup label="Asset Tags">
          <option value="56">ExportAssets (56)</option>
          <option value="57">ImportAssets (57)</option>
          <option value="71">ImportAssets2 (71)</option>
          <option value="76">SymbolClass (76)</option>
        </optgroup>
        <!-- ActionScript Tags -->
        <optgroup label="ActionScript Tags">
          <option value="12">DoAction (12)</option>
          <option value="59">DoInitAction (59)</option>
          <option value="82">DoABC (82)</option>
        </optgroup>
        <!-- Shape Tags -->
        <optgroup label="Shape Tags">
          <option value="2">DefineShape (2)</option>
          <option value="22">DefineShape2 (22)</option>
          <option value="32">DefineShape3 (32)</option>
          <option value="83">DefineShape4 (83)</option>
        </optgroup>
        <!-- Sprite Tags -->
        <optgroup label="Sprite Tags">
          <option value="39">DefineSprite (39)</option>
        </optgroup>
        <!-- Font Tags -->
        <optgroup label="Font Tags">
          <option value="10">DefineFont (10)</option>
          <option value="13">DefineFontInfo (13)</option>
          <option value="48">DefineFont2 (48)</option>
          <option value="62">DefineFontInfo2 (62)</option>
          <option value="73">DefineFontAlignZones (73)</option>
          <option value="75">DefineFont3 (75)</option>
          <option value="88">DefineFontName (88)</option>
          <option value="90">DefineFont4 (90)</option>
        </optgroup>
        <!-- Text Tags -->
        <optgroup label="Text Tags">
          <option value="11">DefineText (11)</option>
          <option value="33">DefineText2 (33)</option>
          <option value="37">DefineEditText (37)</option>
          <option value="74">CSMTextSettings (74)</option>
        </optgroup>
        <!-- Bitmap Tags -->
        <optgroup label="Bitmap Tags">
          <option value="6">DefineBits (6)</option>
          <option value="8">JPEGTables (8)</option>
          <option value="20">DefineBitsLossless (20)</option>
          <option value="21">DefineBitsJPEG2 (21)</option>
          <option value="35">DefineBitsJPEG3 (35)</option>
          <option value="36">DefineBitsLossless2 (36)</option>
        </optgroup>
        <!-- Sound Tags -->
        <optgroup label="Sound Tags">
          <option value="14">DefineSound (14)</option>
          <option value="15">StartSound (15)</option>
          <option value="17">DefineButtonSound (17)</option>
          <option value="18">SoundStreamHead (18)</option>
          <option value="19">SoundStreamBlock (19)</option>
          <option value="45">SoundStreamHead2 (45)</option>
        </optgroup>
        <!-- Button Tags -->
        <optgroup label="Button Tags">
          <option value="7">DefineButton (7)</option>
          <option value="23">DefineButtonCxform (23)</option>
          <option value="34">DefineButton2 (34)</option>
        </optgroup>
        <!-- Video Tags -->
        <optgroup label="Video Tags">
          <option value="60">DefineVideoStream (60)</option>
          <option value="61">VideoFrame (61)</option>
        </optgroup>
        <!-- Morph Shape Tags -->
        <optgroup label="Morph Shape Tags">
          <option value="46">DefineMorphShape (46)</option>
          <option value="84">DefineMorphShape2 (84)</option>
        </optgroup>
        <!-- Scaling Tags -->
        <optgroup label="Scaling Tags">
          <option value="78">DefineScalingGrid (78)</option>
        </optgroup>
      </select>
    </div>

    <button class="button" id="applyFilterButton">Apply Filter</button>
  </div>

  <!-- Translator Controls -->
  <div class="translator-controls hidden" id="translatorControls">
    <span class="filter-label">Translator Options:</span>
    
    <div class="filter-group">
      <label class="filter-label">Translate:</label>
      <select id="translatorType">
        <option value="shape">Shape Data</option>
        <option value="display">Display Data</option>
        <option value="both">Both Types</option>
      </select>
    </div>

    <button class="button" id="runTranslatorButton">Run Translation</button>
    <button class="button" id="clearTranslatorButton">Clear Output</button>
  </div>

  <div class="terminals-container" id="terminalsContainer">
    <div class="single-terminal" id="singleTerminalContainer">
      <div class="terminal-header">
        <h3 class="terminal-title">Terminal Output</h3>
      </div>
      <div class="terminal" id="terminalOutput">Waiting for file input...</div>
    </div>
  </div>

  <script>
    const terminal = document.getElementById('terminalOutput');
    const uploadButton = document.getElementById('uploadButton');
    const fileInput = document.getElementById('SWF-Input');
    const fileNameDisplay = document.getElementById('fileName');
    const toggleButton = document.getElementById('toggleButton');
    const contentButton = document.getElementById('contentButton');
    const unparsedButton = document.getElementById('unparsedButton');
    const errorButton = document.getElementById('errorButton');
    const translatorButton = document.getElementById('translatorButton');
    const filterContainer = document.getElementById('filterContainer');
    const translatorControls = document.getElementById('translatorControls');
    const categoryFilter = document.getElementById('categoryFilter');
    const specificTagFilter = document.getElementById('specificTagFilter');
    const applyFilterButton = document.getElementById('applyFilterButton');
    const translatorType = document.getElementById('translatorType');
    const runTranslatorButton = document.getElementById('runTranslatorButton');
    const clearTranslatorButton = document.getElementById('clearTranslatorButton');
    const terminalsContainer = document.getElementById('terminalsContainer');
    const singleTerminalContainer = document.getElementById('singleTerminalContainer');

    // Initialize global variables
    window.showAllTags = false;
    window.showContentParsing = false;
    window.showUnparsedOnly = false;
    window.showErrorsOnly = false;
    window.showTranslatorOutput = false;
    window.tagTypeFilter = null;
    window.currentFileBuffer = null;
    window.currentParsedData = [];

    // Helper function to reset filter UI
    function resetFilterUI() {
      categoryFilter.value = 'all';
      specificTagFilter.value = 'all';
      window.tagTypeFilter = null;
    }

    // Helper function to setup dual terminals
    function setupDualTerminals() {
      terminalsContainer.innerHTML = `
        <div>
          <div class="terminal-header">
            <h3 class="terminal-title">Parser Output</h3>
          </div>
          <div class="terminal" id="terminalOutput">Waiting for file input...</div>
        </div>
        <div>
          <div class="terminal-header">
            <h3 class="terminal-title">Translator Output</h3>
          </div>
          <div class="terminal" id="translatorOutput">Run translation to see output...</div>
        </div>
      `;
    }

    // Helper function to setup single terminal
    function setupSingleTerminal() {
      terminalsContainer.innerHTML = `
        <div class="single-terminal">
          <div class="terminal-header">
            <h3 class="terminal-title">Terminal Output</h3>
          </div>
          <div class="terminal" id="terminalOutput">Waiting for file input...</div>
        </div>
      `;
    }

    // Add button functionality
    uploadButton.addEventListener('click', function() {
      fileInput.click();
    });

    // Toggle button functionality
    toggleButton.addEventListener('click', function() {
      window.showAllTags = !window.showAllTags;
      toggleButton.textContent = window.showAllTags ? 'Show Important Tags' : 'Show All Tags';
      
      // Re-parse if file is loaded
      reparseCurrentFile();
    });

    // Content parsing button functionality
    contentButton.addEventListener('click', function() {
      window.showContentParsing = !window.showContentParsing;
      
      if (window.showContentParsing) {
        contentButton.textContent = 'Show Tag Headers';
        contentButton.classList.add('active');
        // Show filter controls when in content mode
        filterContainer.classList.remove('hidden');
        // Hide other buttons when in content mode
        toggleButton.style.display = 'none';
        unparsedButton.style.display = 'none';
        errorButton.style.display = 'none';
        translatorButton.style.display = 'none';
        // Reset other modes
        window.showUnparsedOnly = false;
        window.showErrorsOnly = false;
        window.showTranslatorOutput = false;
        unparsedButton.classList.remove('active');
        errorButton.classList.remove('active');
        translatorButton.classList.remove('active');
        translatorControls.classList.add('hidden');
        setupSingleTerminal();
      } else {
        contentButton.textContent = 'Show Parsed Content Only';
        contentButton.classList.remove('active');
        // Hide filter controls when not in content mode
        filterContainer.classList.add('hidden');
        // Reset filter when leaving content mode
        resetFilterUI();
        // Show other buttons when back in header mode
        toggleButton.style.display = 'inline-block';
        unparsedButton.style.display = 'inline-block';
        errorButton.style.display = 'inline-block';
        translatorButton.style.display = 'inline-block';
      }
      
      // Re-parse if file is loaded
      reparseCurrentFile();
    });

    // Unparsed content button functionality
    unparsedButton.addEventListener('click', function() {
      window.showUnparsedOnly = !window.showUnparsedOnly;
      
      if (window.showUnparsedOnly) {
        unparsedButton.textContent = 'Show All Tags';
        unparsedButton.classList.add('active');
        // Hide other buttons when in unparsed mode
        toggleButton.style.display = 'none';
        contentButton.style.display = 'none';
        errorButton.style.display = 'none';
        translatorButton.style.display = 'none';
        filterContainer.classList.add('hidden');
        translatorControls.classList.add('hidden');
        // Reset filter when entering unparsed mode
        resetFilterUI();
        // Reset other modes
        window.showContentParsing = false;
        window.showErrorsOnly = false;
        window.showTranslatorOutput = false;
        contentButton.classList.remove('active');
        errorButton.classList.remove('active');
        translatorButton.classList.remove('active');
        setupSingleTerminal();
      } else {
        unparsedButton.textContent = 'Show Unparsed Tags';
        unparsedButton.classList.remove('active');
        // Show other buttons when back to normal mode
        toggleButton.style.display = 'inline-block';
        contentButton.style.display = 'inline-block';
        errorButton.style.display = 'inline-block';
        translatorButton.style.display = 'inline-block';
      }
      
      // Re-parse if file is loaded
      reparseCurrentFile();
    });

    // Error parsing button functionality
    errorButton.addEventListener('click', function() {
      window.showErrorsOnly = !window.showErrorsOnly;
      
      if (window.showErrorsOnly) {
        errorButton.textContent = 'Show All Tags';
        errorButton.classList.add('active');
        // Show filter controls when in error mode
        filterContainer.classList.remove('hidden');
        // Hide other buttons when in error mode
        toggleButton.style.display = 'none';
        contentButton.style.display = 'none';
        unparsedButton.style.display = 'none';
        translatorButton.style.display = 'none';
        translatorControls.classList.add('hidden');
        // Reset other modes
        window.showContentParsing = false;
        window.showUnparsedOnly = false;
        window.showTranslatorOutput = false;
        contentButton.classList.remove('active');
        unparsedButton.classList.remove('active');
        translatorButton.classList.remove('active');
        setupSingleTerminal();
      } else {
        errorButton.textContent = 'Show Parser Errors';
        errorButton.classList.remove('active');
        // Hide filter controls when not in error mode
        filterContainer.classList.add('hidden');
        // Reset filter when leaving error mode
        resetFilterUI();
        // Show other buttons when back to normal mode
        toggleButton.style.display = 'inline-block';
        contentButton.style.display = 'inline-block';
        unparsedButton.style.display = 'inline-block';
        translatorButton.style.display = 'inline-block';
      }
      
      // Re-parse if file is loaded
      reparseCurrentFile();
    });

    // Translator button functionality
    translatorButton.addEventListener('click', function() {
      window.showTranslatorOutput = !window.showTranslatorOutput;
      
      if (window.showTranslatorOutput) {
        translatorButton.textContent = 'Hide Translator Output';
        translatorButton.classList.add('active');
        // Show translator controls
        translatorControls.classList.remove('hidden');
        // Hide other mode buttons
        toggleButton.style.display = 'none';
        contentButton.style.display = 'none';
        unparsedButton.style.display = 'none';
        errorButton.style.display = 'none';
        filterContainer.classList.add('hidden');
        // Reset other modes
        window.showContentParsing = false;
        window.showUnparsedOnly = false;
        window.showErrorsOnly = false;
        contentButton.classList.remove('active');
        unparsedButton.classList.remove('active');
        errorButton.classList.remove('active');
        resetFilterUI();
        setupDualTerminals();
        // Re-parse to populate parser terminal
        reparseCurrentFile();
      } else {
        translatorButton.textContent = 'Show Translator Output';
        translatorButton.classList.remove('active');
        // Hide translator controls
        translatorControls.classList.add('hidden');
        // Show other buttons
        toggleButton.style.display = 'inline-block';
        contentButton.style.display = 'inline-block';
        unparsedButton.style.display = 'inline-block';
        errorButton.style.display = 'inline-block';
        setupSingleTerminal();
        // Re-parse if file is loaded
        reparseCurrentFile();
      }
    });

    // Filter functionality
    applyFilterButton.addEventListener('click', function() {
      const categoryValue = categoryFilter.value;
      const specificValue = specificTagFilter.value;
      
      if (specificValue !== 'all') {
        // Specific tag filter takes precedence
        window.tagTypeFilter = {
          type: 'specific',
          tagType: parseInt(specificValue)
        };
      } else if (categoryValue !== 'all') {
        // Category filter
        window.tagTypeFilter = {
          type: 'category',
          category: categoryValue
        };
      } else {
        // No filter
        window.tagTypeFilter = null;
      }
      
      // Re-parse if file is loaded
      reparseCurrentFile();
    });

    // Translator functionality
    runTranslatorButton.addEventListener('click', function() {
      if (!window.currentFileBuffer) {
        const translatorOutput = document.getElementById('translatorOutput');
        if (translatorOutput) {
          translatorOutput.textContent = 'No file loaded for translation.';
        }
        return;
      }

      runTranslation();
    });

    clearTranslatorButton.addEventListener('click', function() {
      const translatorOutput = document.getElementById('translatorOutput');
      if (translatorOutput) {
        translatorOutput.textContent = 'Translation output cleared.';
      }
    });

    // Reset specific tag when category changes
    categoryFilter.addEventListener('change', function() {
      if (categoryFilter.value !== 'all') {
        specificTagFilter.value = 'all';
      }
    });

    // Reset category when specific tag changes
    specificTagFilter.addEventListener('change', function() {
      if (specificTagFilter.value !== 'all') {
        categoryFilter.value = 'all';
      }
    });

    // Function to reparse current file
    function reparseCurrentFile() {
      const fileInput = document.getElementById('SWF-Input');
      if (fileInput.files[0] && window.currentFileBuffer) {
        const parsedInfo = parseSWFSignature(window.currentFileBuffer);
        const tagInfo = parseSWFTags(window.currentFileBuffer);
        const terminal = document.getElementById('terminalOutput');
        if (terminal) {
          terminal.textContent = parsedInfo + '\n\n' + tagInfo;
        }
      }
    }

    // Function to run translation
    function runTranslation() {
      if (!window.currentFileBuffer) return;

      const translatorOutput = document.getElementById('translatorOutput');
      if (!translatorOutput) return;

      const typeToTranslate = translatorType.value;
      let output = [];

      output.push("Translation Process Started:");
      output.push("============================");

      try {
        // For demo purposes, create sample data to translate
        // In a real implementation, this would use actual parsed data
        
        if (typeToTranslate === 'shape' || typeToTranslate === 'both') {
          output.push("\n--- Shape Translation ---");
          
          // Sample shape data (this would come from actual parsing)
          const sampleShapeData = {
            tagType: "DefineShape2",
            description: "Defines a vector shape with color transforms",
            data: {
              shapeId: 1,
              bounds: { xMin: 0, yMin: 0, xMax: 1000, yMax: 800 },
              version: 2,
              fillStyles: {
                count: 1,
                styles: [{
                  type: "solid",
                  color: { r: 255, g: 0, b: 0, a: 255 }
                }]
              },
              lineStyles: {
                count: 1,
                styles: [{
                  type: "basic",
                  width: 20,
                  color: { r: 0, g: 0, b: 0 }
                }]
              },
              shapeRecords: {
                recordCount: 5,
                records: [
                  { type: "style_change", flags: { moveTo: true }, moveToX: 100, moveToY: 100 },
                  { type: "straight_edge", deltaX: 200, deltaY: 0 },
                  { type: "straight_edge", deltaX: 0, deltaY: 150 },
                  { type: "straight_edge", deltaX: -200, deltaY: 0 },
                  { type: "end" }
                ]
              },
              complexity: "simple",
              hasTransparency: false
            }
          };

          if (typeof ShapeParserTranslator !== 'undefined') {
            const shapeTranslator = new ShapeParserTranslator();
            const result = shapeTranslator.translateShapeData(sampleShapeData);
            output.push(result.output);
          } else {
            output.push("ShapeParserTranslator not available");
          }
        }

        if (typeToTranslate === 'display' || typeToTranslate === 'both') {
          output.push("\n--- Display Translation ---");
          
          // Sample display data (this would come from actual parsing)
          const sampleDisplayData = {
            tagType: "PlaceObject2",
            description: "Places/modifies a character on the display list (extended)",
            data: {
              flags: {
                hasCharacter: true,
                hasMatrix: true,
                hasColorTransform: false,
                hasMove: false,
                hasName: true
              },
              depth: 1,
              characterId: 1,
              matrix: {
                scaleX: 1.0,
                scaleY: 1.0,
                rotateSkew0: 0.0,
                rotateSkew1: 0.0,
                translateX: 200,
                translateY: 100
              },
              name: "myShape",
              isMove: false,
              isNewPlacement: true
            }
          };

          if (typeof DisplayParserTranslator !== 'undefined') {
            const displayTranslator = new DisplayParserTranslator();
            const result = displayTranslator.translateDisplayData(sampleDisplayData);
            output.push(result.output);
          } else {
            output.push("DisplayParserTranslator not available");
          }
        }

        output.push("\n============================");
        output.push("Translation Process Completed");

      } catch (error) {
        output.push(`\nTranslation Error: ${error.message}`);
      }

      translatorOutput.textContent = output.join('\n');
    }

    document.getElementById('SWF-Input').addEventListener('change', async function(event) {
      const file = event.target.files[0];
      if (!file) {
        const terminal = document.getElementById('terminalOutput');
        if (terminal) {
          terminal.textContent = 'No file selected.';
        }
        return;
      }

      // Display file name
      fileNameDisplay.textContent = file.name;

      const fileName = file.name;
      const extension = fileName.split('.').pop().toLowerCase();

      if (extension !== 'swf') {
        const terminal = document.getElementById('terminalOutput');
        if (terminal) {
          terminal.textContent = 'Error: File is not in SWF file format. Please use only SWF files.';
        }
        window.start = false;
        return;
      }

      const terminal = document.getElementById('terminalOutput');
      if (terminal) {
        terminal.textContent = 'Determined that file is in SWF format...\nReading file...';
      }
      window.start = true;

      try {
        const arrayBuffer = await file.arrayBuffer();
        window.currentFileBuffer = arrayBuffer;
        
        const parsedInfo = parseSWFSignature(arrayBuffer);
        const tagInfo = parseSWFTags(arrayBuffer);
        
        if (terminal) {
          terminal.textContent = parsedInfo + '\n\n' + tagInfo;
        }
      } catch (err) {
        if (terminal) {
          terminal.textContent = 'Error reading SWF file: ' + err.message;
        }
      }
    });
  </script>

  <!-- Load external libraries first -->
  <script src="https://cdn.jsdelivr.net/npm/pako@2.0.4/dist/pako.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/LZMA-JS/LZMA-JS@master/src/lzma-d.js"></script>
  
  <!-- Load parser modules in dependency order -->
  <script src="JS/parsers/DataTypes.js"></script>
  <script src="JS/parsers/AS3Parsers.js"></script>
  <script src="JS/parsers/ControlParsers.js"></script>
  <script src="JS/parsers/DisplayParsers.js"></script>
  <script src="JS/parsers/AssetParsers.js"></script>
  <script src="JS/parsers/ShapeParsers.js"></script>
  <script src="JS/parsers/SpriteParsers.js"></script>
  <script src="JS/parsers/FontParsers.js"></script>
  <script src="JS/parsers/TextParsers.js"></script>
  <script src="JS/parsers/BitmapParsers.js"></script>
  <script src="JS/parsers/SoundParsers.js"></script>
  <script src="JS/parsers/ButtonParsers.js"></script>
  <script src="JS/parsers/VideoParsers.js"></script>
  <script src="JS/parsers/MorphParsers.js"></script>
  <script src="JS/parsers/ScalingParsers.js"></script>
  
  <!-- Load translator modules -->
  <script src="JS/translators/ShapeParserTranslator.js"></script>
  <script src="JS/translators/DisplayParserTranslator.js"></script>
  
  <!-- Load core parsing files -->
  <script src="JS/TagParse.js"></script>
  
  <!-- Load Parse.js LAST as it runs commands from other files -->
  <script src="JS/Parse.js"></script>
</body>
</html>
